{% extends 'base.html'%}
{% load i18n %}
{%block body%}

</script>
<style>
    a.active {
        font-weight: bold;
        border-bottom: #007bff;
    }
    .al-range-slider__input {
        display: none;
    }
    
</style>
<div id='save_confirmation' class="p-2 mt-5 alert alert-success alert-dismissible fade show" role="alert" style="display:none;">
  {% translate 'Your search parameters have been saved in your searches.'%}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
  <span aria-hidden="true">&times;</span>
  </button>
</div>
<div x-data = "{ selected_scenarios:[], compare:false,
  toggle(id) {
      if (this.selected_scenarios.includes(id)) {
          const index = this.selected_scenarios.indexOf(id);
          this.selected_scenarios.splice(index, 1)
      } else {
          this.selected_scenarios.push(id);
      }
  },
  check(){
    if (this.selected_scenarios.length == 2){
      return true;
    }else{
      return false;
    }
  }
}" class="m-4 p-5" >
    
    <h3 >     {% translate 'Scenario Inspection'%} </h3>
    <p class="'text-secondary">    {% translate 'The table below presents to you the overall indicators of each scenario generated. You can select scenarios for detailed inspection clicking on Inspect, on the right side of the table. Further actions are available to explore and download the generated options.'%}  </p>
    
    <div class='d-flex flex-row-reverse p-2 m-2'>
      {% if user.is_authenticated %}
        <i x-on:click="downloadCSV" title="download"  class="fa fa-download  px-2 bg-primary text-white p-3 rounded-top rounded-bottom mx-2 btn btn-primary"></i> 
        <i title="compare"   class="fa fa-exchange-alt  px-2 bg-primary text-white p-3 rounded-top rounded-bottom mx-2 btn btn-primary" data-toggle='modal' data-placement='top' data-target="#compare_modal"></i> 
        <i title="save"  class="fa fa-save  pr-2 bg-primary text-white p-3 rounded-top mx-2 rounded-bottom btn btn-primary"  data-toggle='modal' data-placement='top' data-target="#save_modal"></i> 
       {%else %}
       <i title="download"  class="fa fa-download  px-2 bg-secondary text-white p-3 rounded-top rounded-bottom mx-2 btn btn-primary" data-toggle='modal' data-placement='top' data-target="#disable_modal"></i> 
        <i title="compare"   class="fa fa-exchange-alt  px-2 bg-secondary text-white p-3 rounded-top rounded-bottom mx-2 btn btn-primary" data-toggle='modal' data-placement='top' data-target="#disable_modal"></i> 
        <i title="save"  class="fa fa-save  pr-2 bg-secondary text-white p-3 rounded-top mx-2 rounded-bottom btn btn-primary"  data-toggle='modal' data-placement='top' data-target="#disable_modal"></i> 
       
        {% endif %}
        <i title="restart"  class="fa fa-undo  pr-2 bg-primary text-white p-3 rounded-top mx-2 rounded-bottom btn btn-primary"  data-toggle='modal' data-placement='top' data-target="#back_modal"></i> 
        
    </div>
    <div class="modal fade" id="disable_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header border-bottom-0">
            <h5 class="modal-title" id="exampleModalLabel">{% translate 'Need authentication'%}
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class='modal-body'>
          {% translate 'This feature is supported for authenticated users only.'%}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">{% translate 'Close'%}</button>
        </div>
    </div>
  </div>
</div>
    <div class="modal fade" id="back_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="exampleModalLabel">   {% translate 'Are you sure'%}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class='modal-body'>
              {% translate 'Confirming this choice will erase all settings defined for these scenarios.'%}
            </div>
            <div class="modal-footer">
              <a href="{% url 'interface' project_id=1 starting_scenario='a'%}" type="button" class="btn btn-primary"> {% translate 'Confirm'%}</a>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">   {% translate 'Cancel'%}</button>
            </div>
        </div>
      </div>
    </div>
    <div class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
    aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
       
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="exampleModalLabel1">    {% translate 'Saved successsfully !'%}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class='modal-body'> 
              <p>    {% translate 'Your search parameters have been saved in your saved search.'%}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">   {% translate 'Cancel'%}</button>
            </div>

        </div>
      </div>
    </div>
    <div class="modal fade" id="save_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
    aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
       
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="exampleModalLabel">   {% translate 'Save this query parameters?'%}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class='modal-body'>
              
                <div class="form-group">
                  <label for="exampleInputEmail1">   {% translate 'Name'%}</label>
                  <input type="text" class="form-control" id="search_param_name" name="label" aria-describedby="emailHelp" placeholder="">
                  <small  class="form-text text-muted">   {% translate 'Search parameters will be saved with the specified label.'%}</small>
                </div>
              
            </div>
            <div class="modal-footer">
              <button id='save_params' type="submit" class="btn btn-primary">   {% translate 'Save'%}</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">   {% translate 'Cancel'%}</button>
            </div>

        </div>
      </div>
    </div>
    <div class="modal fade" id="compare_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
    aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title" id="exampleModalLabel">   {% translate 'Compare two scenarios'%}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class='modal-body'>
              <template class='align-text-center' x-if="check()">
                <div class="p-2">
                <p> {% translate 'Scenarios selected for side-by-side comparison' %} </p>
                <div class='d-flex justify-content-center'>
                  <p class='px-4 py-1 mx-1  bg-light text-muted rounded'  x-text='selected_scenarios[0]'></p>
                  <p class='px-4 py-1 mx-1 bg-light text-muted rounded'  x-text='selected_scenarios[1]'></p>
                </div>
                </div>
              </template>
              <template x-if="!check()">
                <div>
                  <i class='px-2 py-1 rounded bg-danger text-white fa fa-exclamation '></i>    {% translate 'You need to select two scenarios for comparison.'%}
                </div>
              </template>
            </div>
            <div class="modal-footer">
              <template x-if="check()">
                <div>
                 
                  <a x-bind:href="'/compare/' + selected_scenarios[0] + '/' + selected_scenarios[1] + '/'" class="btn btn-primary text-white">   {% translate 'Compare'%}</a>
                </div>
                </form>
              </template>
              <template x-if="!check()">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">   {% translate 'Close'%}</button>
            </template>
            </div>
        </div>
    </div>
  </div>
        <div x-data="{power:true, infra:true, pace:true, storage:true,wind_onshore:true,wind_offshore:false,roof_pv:false,field_pv:false,global:true,water:false,land:false}" class="row m-4 p-4 min-vh-100">
            <div class="col-auto col-md-3 col-xl-2  mr-5">
                <div class="d-flex flex-column align-items-center px-5 pt-2 ">
                    <div id="accordion">
                        <div class="card">
                          <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                              <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                {% translate 'Energy System Settings'%}
                              </button>
                            </h5>
                          </div>
                      
                          <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                            <div class="card-body p-1">
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox" x-model="power" @click="power = !power">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Power Generation Capacity'%}
                                        </small>
                                      </div>
                                    </div> 
                                    <!-- <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox" >
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Total Energy Supply'%}
                                        </small>
                                      </div>
                                    </div> 
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Transmission'%}
                                        </small>
                                      </div>
                                    </div> -->
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox" x-model="storage" @click="storage = !storage">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Storage Capacity'%}
                                        </small>
                                      </div>
                                    </div> 
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox" x-model="pace" @click="pace = !pace">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Implementation Pace'%}
                                        </small>
                                      </div>
                                    </div> 
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox" x-model="infra" @click="infra = !infra">>
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Community-led  Infrastructured'%}
                                        </small>
                                      </div>
                                    </div> 
                                  <!--  <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <small>
                                          {% translate 'Electrification (Heating)'%}
                                        </small>
                                      </div>
                                    </div> 
                                    <div class="d-flex  border-bottom align-items-center">
                                      <div class=''>
                                        <label class="switch pt-1">
                                          <input type="checkbox">
                                          <span class="slider round"></span>
                                        </label>
                                      </div>
                                      <div class='pl-2'>
                                        <p class='small'>
                                          {% translate 'Electrification (Transport)'%}
                                        </p>
                                      </div>
                                    </div>  -->
                            </div>
                          </div>
                        </div>
                        <div class="card">
                          <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                {% translate 'Energy Technology'%}
                              </button>
                            </h5>
                          </div>
                          <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                            <div class="card-body p-1">
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="wind_onshore" @click="wind_onshore = !wind_onshore">
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'Wind On-shore'%}
                                  </small>
                                </div>
                              </div> 
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="wind_offshore" @click="wind_offshore = !wind_offshore">
        
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'Wind Off-shore'%}
                                  </small>
                                </div>
                              </div> 
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="roof_pv" @click="roof_pv = !roof_pv">
                                   
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'PV Roof-mounted'%}
                                  </small>
                                </div>
                              </div> 
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="field_pv" @click="field_pv = !field_pv">
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'PV Open-field'%}
                                  </small>
                                </div>
                              </div>    
                      </div>
                          </div>
                        </div>
                        <div class="card">
                          <div class="card-header" id="headingThree">
                            <h5 class="mb-0">
                              <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                {% translate 'Impacts Control' %}
                              </button>
                            </h5>
                          </div>
                          <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                            <div class="card-body">
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="global" @click="global = !global">
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'Global Warming Potential (GWP)'%}
                                  </small>
                                </div>
                              </div> 
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox"x-model="water" @click="water = !water">
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'Water Consumption'%}
                                  </small>
                                </div>
                              </div> 
                              <div class="d-flex  border-bottom align-items-center">
                                <div class=''>
                                  <label class="switch pt-1">
                                    <input type="checkbox" x-model="land" @click="land = !land">
                                    <span class="slider round"></span>
                                  </label>
                                </div>
                                <div class='pl-2'>
                                  <small>
                                    {% translate 'Agricultural Land Occupation'%}
                                  </small>
                                </div>
                              </div> 
                                
                            </div>
                          </div>
                        </div>
                      </div>
                </div>
            </div>
            <div class="col table-responsive" >
                <table class="table">
                    <thead>
                        <tr>
                            
                            <th>   {% translate 'Scenario'%} ID</th>
                            <th x-show="power">   {% translate 'Power capacity'%} (GW)</th>
                            <th x-show="storage">   {% translate 'Storage capacity'%} (TWh)</th>
                            <th x-show="pace">   {% translate 'Community-led Infrastructure'%}</th>
                            <th x-show="infra">   {% translate 'Implementation Pace'%}</th>
                            <th>   {% translate 'Import dependency'%}</th>
                            
                            <th x-show="wind_onshore">   {% translate 'Wind On-shore'%} (GW) </th>
                            <th x-show="wind_offshore">   {% translate 'Wind Off-shore'%} (GW) </th>
                            <th x-show="roof_pv">   {% translate 'PV Roof-mounted'%} (GW)</th>
                            <th x-show="field_pv">   {% translate 'PV Open-field'%} (GW)</th>
                            <th x-show="global">   {% translate 'Global Warming Potential'%}</th>
                            <th x-show="water">   {% translate 'Water consumption'%}</th>
                            <th x-show="land">   {% translate 'Land occupation'%}</th>
                            <th ></th>
                           
                        </tr>
                    </thead>
                    
                    <tbody>
                        {% for scenario in page_obj %}
                        <tr class='text-align-middle'>
                            
                            <td ><input type='checkbox' x-on:click="toggle({{scenario.id}})" value='{{scenario.id}}' name='scenario'> {{scenario.id}}</td>
                            <td x-show="power">{{scenario.power_capacity |floatformat:2}}</td>
                            <td x-show="storage">{{scenario.storage_capacity |floatformat:2}}</td>
                            <td x-show="infra">{{scenario.community_infrastructure |floatformat:2}}</td>
                            <td x-show="pace">{{scenario.implementation_pace |floatformat:2}}</td>
                            <td >{{scenario.import_dependency |floatformat:4}}</td>
                            <td x-show="wind_onshore">{{scenario.wind_onshore |floatformat:2}}</td>
                            <td x-show="wind_offshore">{{scenario.wind_offshore |floatformat:2}}</td>
                            <td x-show="roof_pv">{{scenario.roof_mounted_pv |floatformat:2}}</td>
                            <td x-show="field_pv">{{scenario.open_field_pv |floatformat:2}}</td>
                            <td x-show="global">{{scenario.global_warming |floatformat:2}}</td>
                            <td x-show="water">{{scenario.water_consumption |floatformat:2}}</td>
                            <td x-show="land">{{scenario.land_occupation |floatformat:2}}</td>
                            <td > <a href='{% url 'inspect' project_id=project_id scenario_id=scenario.id %}' class='px-3  bg-light rounded-top rounded-bottom text-primary border border-primary'>   {% translate 'Inspect'%}</a></td>
                           
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>




</div>
{% endblock%}
{% block scr %}
function downloadCSV(e){
  var scenarios = {{ json_format | safe}};
  let csvContent = "data:text/csv;charset=utf-8,";
  let headers = '';
  for(var key in scenarios) {
    data = scenarios[key];
    if (headers == ''){
      for(var f in data.fields){
        headers += f + ',';
      }
      csvContent +=  headers + "\r\n";
    }
    row = "";
    for(var f in data.fields){
    row += data.fields[f] + ',';
  }
    csvContent +=  row + "\r\n";
    
  } 
  var encodedUri = encodeURI(csvContent);
  window.open(encodedUri);    
}

$(document).ready(function () {
  $("#save_params").click(function (event) {
    let val = $("#search_param_name").val();
    $.ajax({
      type: "POST",
      url: "/save/" + val + "/",
      data: {{ search_params | safe }},
      success: function () {
        console.log('Data is saved');
        $('#save_modal').modal('toggle')
        $('#save_confirmation').css('display','block');
      }
    });
    return false; //<---- move it here
  });

});

{% endblock%}